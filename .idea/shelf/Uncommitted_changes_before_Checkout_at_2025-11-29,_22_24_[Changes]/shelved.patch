Index: app/src/main/java/com/example/a1112/SignUpActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.a1112;\n\nimport android.os.Bundle;\nimport android.view.View;\nimport android.widget.*;\nimport android.content.Intent;\n\nimport androidx.appcompat.app.AppCompatActivity;\n\nimport com.google.firebase.auth.FirebaseAuth;\nimport com.google.firebase.firestore.FirebaseFirestore;\n\nimport java.util.*;\n\npublic class SignUpActivity extends AppCompatActivity {\n\n    private FirebaseAuth auth;\n    private FirebaseFirestore db;\n\n    private EditText emailField, passwordField;\n    private EditText childNameField, childAgeField;\n    private EditText childUsernameField, childPasswordField;   // <-- NEW\n\n    private RadioGroup roleGroup;\n    private LinearLayout childFields;\n    private Button registerButton;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_sign_up);\n\n        auth = FirebaseAuth.getInstance();\n        db = FirebaseFirestore.getInstance();\n\n        emailField = findViewById(R.id.emailField);\n        passwordField = findViewById(R.id.passwordField);\n        childNameField = findViewById(R.id.childNameField);\n        childAgeField = findViewById(R.id.childAgeField);\n\n        childUsernameField = findViewById(R.id.childUsernameField);  // <-- NEW\n        childPasswordField = findViewById(R.id.childPasswordField);  // <-- NEW\n\n        roleGroup = findViewById(R.id.roleGroup);\n        childFields = findViewById(R.id.childFields);\n\n        registerButton = findViewById(R.id.registerButton);\n\n        roleGroup.setOnCheckedChangeListener((group, checkedId) -> {\n            if (checkedId == R.id.roleParent || checkedId == R.id.roleChild) {\n                childFields.setVisibility(View.VISIBLE);\n            } else {\n                childFields.setVisibility(View.GONE);\n            }\n        });\n\n        registerButton.setOnClickListener(v -> registerUser());\n    }\n\n    private void registerUser() {\n\n        String email = emailField.getText().toString().trim().toLowerCase();\n        String password = passwordField.getText().toString().trim();\n\n        String childName = childNameField.getText().toString().trim();\n        String childAge = childAgeField.getText().toString().trim();\n\n        String childUsername = childUsernameField.getText().toString().trim();\n        String childPassword = childPasswordField.getText().toString().trim();\n\n        int roleId = roleGroup.getCheckedRadioButtonId();\n        if (roleId == -1) {\n            Toast.makeText(this, \"Select a role\", Toast.LENGTH_SHORT).show();\n            return;\n        }\n\n        String role = ((RadioButton) findViewById(roleId)).getText().toString();\n\n        // If Parent / Child → child info is needed\n        if ((role.equals(\"Parent\") || role.equals(\"Child\")) &&\n                (childName.isEmpty() || childAge.isEmpty())) {\n            Toast.makeText(this, \"Child name and age required\", Toast.LENGTH_SHORT).show();\n            return;\n        }\n\n        // Handle username/password rules only for Parent signup\n        boolean bothEmpty = childUsername.isEmpty() && childPassword.isEmpty();\n        boolean bothFilled = !childUsername.isEmpty() && !childPassword.isEmpty();\n\n        if (role.equals(\"Parent\")) {\n            if (!bothEmpty && !bothFilled) {\n                Toast.makeText(this,\n                        \"Child username and password must BOTH be empty or BOTH be filled\",\n                        Toast.LENGTH_SHORT).show();\n                return;\n            }\n        }\n\n        // Step 1: Create FirebaseAuth user\n        auth.createUserWithEmailAndPassword(email, password)\n                .addOnSuccessListener(task -> {\n\n                    String uid = auth.getCurrentUser().getUid();\n\n                    Map<String, Object> userData = new HashMap<>();\n                    userData.put(\"email\", email);\n                    userData.put(\"role\", role);\n                    userData.put(\"hasCompletedOnboarding\", false);\n                    userData.put(\"linkedChildren\", new ArrayList<>());\n\n                    db.collection(\"users\").document(uid)\n                            .set(userData)\n                            .addOnSuccessListener(ignored -> {\n\n                                switch (role) {\n                                    case \"Provider\":\n                                        goLogin();\n                                        break;\n\n                                    case \"Child\":\n                                        createSelfChild(uid, childName, childAge, childUsername, childPassword);\n                                        break;\n\n                                    case \"Parent\":\n                                        if (bothFilled) {\n                                            checkUsernameAndCreateChild(uid, childName, childAge,\n                                                    childUsername, childPassword);\n                                        } else {\n                                            // No child login, but still create child\n                                            createChildWithoutLogin(uid, childName, childAge);\n                                        }\n                                        break;\n                                }\n                            });\n                })\n                .addOnFailureListener(e ->\n                        Toast.makeText(this, \"Signup failed\", Toast.LENGTH_SHORT).show());\n    }\n\n    private void checkUsernameAndCreateChild(\n            String parentUid, String name, String age,\n            String username, String password) {\n\n        db.collection(\"children\")\n                .whereEqualTo(\"username\", username)\n                .get()\n                .addOnSuccessListener(snap -> {\n\n                    if (!snap.isEmpty()) {\n                        Toast.makeText(this,\n                                \"Username already taken\",\n                                Toast.LENGTH_SHORT).show();\n                        return;\n                    }\n\n                    createChildWithLogin(parentUid, name, age, username, password);\n                });\n    }\n\n    private void createChildWithLogin(\n            String parentUid, String name, String age,\n            String username, String password) {\n\n        String childId = UUID.randomUUID().toString();\n\n        Map<String, Object> child = new HashMap<>();\n        child.put(\"name\", name);\n        child.put(\"age\", age);\n        child.put(\"parentId\", parentUid);\n        child.put(\"username\", username);\n        child.put(\"password\", password);\n        child.put(\"hasCompletedOnboarding\", false);\n\n        db.collection(\"children\").document(childId)\n                .set(child)\n                .addOnSuccessListener(ignored -> {\n                    linkChildToParent(parentUid, childId);\n                });\n    }\n\n    private void createChildWithoutLogin(String parentUid, String name, String age) {\n\n        String childId = UUID.randomUUID().toString();\n\n        Map<String, Object> child = new HashMap<>();\n        child.put(\"name\", name);\n        child.put(\"age\", age);\n        child.put(\"parentId\", parentUid);\n        child.put(\"username\", null);\n        child.put(\"password\", null);\n        child.put(\"hasCompletedOnboarding\", false);\n\n        db.collection(\"children\").document(childId)\n                .set(child)\n                .addOnSuccessListener(ignored -> {\n                    linkChildToParent(parentUid, childId);\n                });\n    }\n\n    private void createSelfChild(String uid, String name, String age,\n                                 String username, String password) {\n\n        Map<String, Object> child = new HashMap<>();\n        child.put(\"name\", name);\n        child.put(\"age\", age);\n        child.put(\"parentId\", null);\n        child.put(\"username\", username);\n        child.put(\"password\", password);\n        child.put(\"hasCompletedOnboarding\", false);\n\n        db.collection(\"children\").document(uid)  // Self-signup uses uid\n                .set(child)\n                .addOnSuccessListener(ignored -> goLogin());\n    }\n\n    private void linkChildToParent(String parentUid, String childId) {\n        db.collection(\"users\").document(parentUid)\n                .update(\"linkedChildren\", com.google.firebase.firestore.FieldValue.arrayUnion(childId))\n                .addOnSuccessListener(ignored -> goLogin());\n    }\n\n    private void goLogin() {\n        Toast.makeText(this, \"Signup successful!\", Toast.LENGTH_SHORT).show();\n        startActivity(new Intent(this, LoginActivityView.class));\n        finish();\n    }\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/a1112/SignUpActivity.java b/app/src/main/java/com/example/a1112/SignUpActivity.java
--- a/app/src/main/java/com/example/a1112/SignUpActivity.java	(revision 0c94861985e981a51c62367e173bbc43031a3e01)
+++ b/app/src/main/java/com/example/a1112/SignUpActivity.java	(date 1764459520844)
@@ -19,7 +19,7 @@
 
     private EditText emailField, passwordField;
     private EditText childNameField, childAgeField;
-    private EditText childUsernameField, childPasswordField;   // <-- NEW
+    private EditText childUsernameField, childPasswordField;
 
     private RadioGroup roleGroup;
     private LinearLayout childFields;
@@ -38,8 +38,8 @@
         childNameField = findViewById(R.id.childNameField);
         childAgeField = findViewById(R.id.childAgeField);
 
-        childUsernameField = findViewById(R.id.childUsernameField);  // <-- NEW
-        childPasswordField = findViewById(R.id.childPasswordField);  // <-- NEW
+        childUsernameField = findViewById(R.id.childUsernameField);
+        childPasswordField = findViewById(R.id.childPasswordField);
 
         roleGroup = findViewById(R.id.roleGroup);
         childFields = findViewById(R.id.childFields);
@@ -76,8 +76,8 @@
 
         String role = ((RadioButton) findViewById(roleId)).getText().toString();
 
-        // If Parent / Child → child info is needed
-        if ((role.equals("Parent") || role.equals("Child")) &&
+        // If Parent  -> child info is needed
+        if ((role.equals("Parent") ) &&
                 (childName.isEmpty() || childAge.isEmpty())) {
             Toast.makeText(this, "Child name and age required", Toast.LENGTH_SHORT).show();
             return;
@@ -96,7 +96,7 @@
             }
         }
 
-        // Step 1: Create FirebaseAuth user
+        //Create FirebaseAuth user
         auth.createUserWithEmailAndPassword(email, password)
                 .addOnSuccessListener(task -> {
 
